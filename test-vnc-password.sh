#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è VNC —Å –ø–∞—Ä–æ–ª–µ–º –∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è

echo "üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ VNC —Å –ø–∞—Ä–æ–ª–µ–º –∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è"
echo "============================================="

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
pkill -f "qemu-system-x86_64" 2>/dev/null || true
pkill -f websockify 2>/dev/null || true

# –ñ–¥–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
sleep 2

echo ""
echo "1Ô∏è‚É£ –¢–µ—Å—Ç 1: VNC –ë–ï–ó –ø–∞—Ä–æ–ª—è"
echo "---------------------------"

# –ó–∞–ø—É—Å–∫–∞–µ–º QEMU –±–µ–∑ –ø–∞—Ä–æ–ª—è
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º QEMU —Å VNC –±–µ–∑ –ø–∞—Ä–æ–ª—è..."
qemu-system-x86_64 -m 1G -smp 2 -vnc :1 -drive file=desqemu-desktop/resources/qcow2/alpine-bootable.qcow2,format=qcow2,if=virtio -daemonize

sleep 3

echo "‚úÖ QEMU –∑–∞–ø—É—â–µ–Ω"
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç 5901..."
lsof -i :5901

echo ""
echo "üåê –ó–∞–ø—É—Å–∫–∞–µ–º websockify..."
websockify 6901 localhost:5901 &
sleep 2

echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç 6901..."
lsof -i :6901

echo ""
echo "üîó –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å..."
open http://localhost:6901

echo ""
echo "‚è≥ –ñ–¥–µ–º 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è..."
sleep 10

echo ""
echo "2Ô∏è‚É£ –¢–µ—Å—Ç 2: VNC –° –ø–∞—Ä–æ–ª–µ–º"
echo "-------------------------"

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π QEMU
pkill -f "qemu-system-x86_64" 2>/dev/null || true
pkill -f websockify 2>/dev/null || true
sleep 2

# –ó–∞–ø—É—Å–∫–∞–µ–º QEMU —Å –ø–∞—Ä–æ–ª–µ–º
echo "üöÄ –ó–∞–ø—É—Å–∫–∞–µ–º QEMU —Å VNC –∏ –ø–∞—Ä–æ–ª–µ–º..."
qemu-system-x86_64 -m 1G -smp 2 -vnc :1,password=on -drive file=desqemu-desktop/resources/qcow2/alpine-bootable.qcow2,format=qcow2,if=virtio -daemonize

sleep 3

echo "‚úÖ QEMU –∑–∞–ø—É—â–µ–Ω —Å –ø–∞—Ä–æ–ª–µ–º"
echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç 5901..."
lsof -i :5901

echo ""
echo "üåê –ó–∞–ø—É—Å–∫–∞–µ–º websockify..."
websockify 6901 localhost:5901 &
sleep 2

echo "üìä –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç 6901..."
lsof -i :6901

echo ""
echo "üîó –û—Ç–∫—Ä—ã–≤–∞–µ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å..."
open http://localhost:6901

echo ""
echo "üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:"
echo "================================"
echo "1. –í –ø–µ—Ä–≤–æ–º —Ç–µ—Å—Ç–µ (–±–µ–∑ –ø–∞—Ä–æ–ª—è) - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ä–∞–∑—É"
echo "2. –í–æ –≤—Ç–æ—Ä–æ–º —Ç–µ—Å—Ç–µ (—Å –ø–∞—Ä–æ–ª–µ–º) - –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏ –ø–∞—Ä–æ–ª—å"
echo "3. –ü–∞—Ä–æ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: password"
echo ""
echo "üîß –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
echo "pkill -f 'qemu-system-x86_64' && pkill -f websockify" 
